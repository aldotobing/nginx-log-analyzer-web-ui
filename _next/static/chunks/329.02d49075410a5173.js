self.onmessage=e=>{let s=e.data,t=s.line||s,r=s.format||"nginx",a={"SQL Injection":RegExp("(?:%27|'|--|;|--\\s|/\\*.*?\\*/|#|%23|%2527)|\\b(?:UNION\\s+(?:ALL\\s+)?SELECT|SELECT\\s+.*?\\bFROM|INSERT\\s+INTO|DELETE\\s+FROM|UPDATE\\s+\\w+\\s+SET|DROP\\s+(?:TABLE|DATABASE)|CREATE\\s+(?:TABLE|DATABASE)|ALTER\\s+TABLE)\\b|(?:[?&][^=]*=(?:%27|'|%2527).*?(?:OR|AND|X?OR|NOT).*?=|\\b(?:OR|AND|X?OR|NOT)\\s+['\\d]\\s*[=<>~!]?=)|\\b(?:EXEC(?:UTE)?(?:\\(|\\s)|EXEC\\s+SP_|XP_|sp_|xp_|WAITFOR\\s+DELAY|SLEEP\\s*\\(|BENCHMARK\\s*\\(|PG_SLEEP\\s*\\(|UPDATEXML\\s*\\(|EXTRACTVALUE\\s*\\()|\\b(?:CHAR\\(|CONCAT\\(|GROUP_CONCAT\\()|[?&][^=]+=(?:%27|'|%2527).*?(?:OR|AND|X?OR|NOT).*?=|[?&][^=]+=.*?(?:--|#|%23|;)","i"),XSS:RegExp("<script[^>]*>|javascript:|(?:on(?:load|error|click|mouse(?:over|out|move)|key(?:down|up|press)|submit|focus|blur|change))\\s*=|eval\\s*\\(|document\\.(?:cookie|location|write|URL|referrer)|<(?:iframe|img|svg|object|embed|frame|frameset|meta|link|form|input|button|textarea|select|option|style|base|body|html)|expression\\s*\\(|data:text(?:html|javascript)|vbscript:","i"),"Command Injection":RegExp("\\b(?:cat|ls|uname|whoami|pwd|rm|touch|wget|curl|scp|rsync|ftp|nc|ncat|nmap|ping|traceroute|telnet|ssh|bash|sh|zsh|dash|powershell|cmd\\.exe|cmd\\/c|\\|\\||&&|;)\\b|\\$\\s*\\(.*\\)|`.*`|\\|\\|\\s*\\w+|&&\\s*\\w+|\\|\\s*\\w+|>\\s*\\w+|<\\s*\\w+|\\b(?:exec|system|passthru|shell_exec|popen|proc_open|pcntl_exec)\\s*\\(","i"),"Directory Traversal":RegExp("(?:^|/|\\\\)(?:\\.{1,2}[/\\\\\\\\]){2,}|(?:^|/|\\\\)(?:%2e%2e|%252e%252e|%c0%ae%c0%ae|%u002e%u002e)[/\\\\\\\\]|/(?:etc/(?:passwd|shadow|group|hosts)|proc/self/environ|windows/win\\.ini|boot\\.ini|php\\.ini|my\\.cnf)(?:/|$|\\x00)|^[a-zA-Z]:\\\\\\\\[^/]+|\\.\\.\\.(?:%2f|%252f|%5c|%255c)|\\\\x00|%00|\\\\0|%25(?:2e|25|5c|2f|5f|3d|3f|26|3a|3b)","i"),"Brute Force":RegExp("\\b(?:wp-|wp_|xmlrpc\\.php|admin-ajax\\.php|wp-login\\.php|wp-admin/)\\b|\\b(?:/admin/|/wp-admin/|/administrator/|/backend/|/control/|/cp/|/cpanel/|/manager/|/admincp/|/admin[1-9]|/admin10/)\\b|\\b(?:/login\\.(?:php|asp|aspx|jsp|do|pl|cgi|cfm|phtml|shtml|rb|py))\\b|(?:/wp-login\\.php|/administrator/login|/admin/login|/user/login|/auth/login|/api/login|/v\\d+/login)","i")},n=t.trim();if(!n)return void self.postMessage({error:"Empty line"});let i=((e,s)=>{try{let t;if("nginx"===s){if(!(t=e.match(/^(\S+) - (\S+) \[(.*?)\] "(\S+) ([^"]*) HTTP\/\d+\.\d+" (\d+) (\d+) "([^"]*)" "([^"]*)" "([^"]*)"$/)))return null;let s=t[5],[r,a]=s.split("?");return{ipAddress:t[1],remoteUser:t[2],timestamp:t[3],method:t[4],path:r,query:a||"",fullPath:s,status:t[6],bodyBytesSent:t[7],referer:t[8],userAgent:t[9],xForwardedFor:t[10]}}if("apache"===s){if(!(t=e.match(/^(\S+)\s+\S+\s+(\S+)\s+\[([^\]]+)\]\s+"(\S+)\s+([^\s"]+)(?:\s+HTTP\/[\d.]+)?"\s+(\d{3})\s+(\d+|-)/)))return null;let s=t[5],[r,a]=s.split("?");return{ipAddress:t[1],remoteUser:t[2],timestamp:t[3],method:t[4],path:r,query:a||"",fullPath:s,status:t[6],bodyBytesSent:"-"===t[7]?"0":t[7],referer:"-",userAgent:"-",xForwardedFor:"-"}}return null}catch(e){return null}})(n,r);if(!i)return void self.postMessage({error:"Failed to parse line"});if(!["GET","POST","PUT","DELETE","HEAD","OPTIONS","PATCH","CONNECT","TRACE"].includes(i.method))return void self.postMessage({error:"Invalid HTTP method"});let o=null,p=i.fullPath||i.path;for(let[e,s]of Object.entries(a))if(s.test(p)){o=e,console.log("ATTACK DETECTED:",e,"Pattern matched:",s);break}let l={...i,attackType:o};self.postMessage({parsedLine:l})},_N_E={};